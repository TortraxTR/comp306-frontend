generator client {
  provider = "prisma-client"
  output   = "../app/generated/prisma"
}

datasource db {
  provider = "mysql"
  url = env("DATABASE_URL")
}

model athlete {
  athlete_id        Int                 @id
  sports_branch     String?             @db.VarChar(100)
  user              user                @relation(fields: [athlete_id], references: [user_id], onDelete: Cascade, map: "fk_athlete_user")
  bodymeasurement   bodymeasurement[]
  medicalassessment medicalassessment[]
  performancelog    performancelog[]
  programenrollment programenrollment[]
  trainerfeedback   trainerfeedback[]
}

model bodymeasurement {
  athlete_id          Int
  measurement_date    DateTime @db.Date
  height              Decimal? @db.Decimal(5, 2)
  weight              Decimal? @db.Decimal(5, 2)
  body_fat_percentage Decimal? @db.Decimal(5, 2)
  muscle_mass         Decimal? @db.Decimal(5, 2)
  bmi                 Decimal? @db.Decimal(5, 2)
  athlete             athlete  @relation(fields: [athlete_id], references: [athlete_id], onDelete: Cascade, map: "fk_body_athlete")

  @@id([athlete_id, measurement_date])
}

model exercise {
  exercise_id        Int                  @id @default(autoincrement())
  exercise_name      String               @db.VarChar(150)
  type               String?              @db.VarChar(100)
  equipment_required String?              @db.VarChar(100)
  difficulty         exercise_difficulty?
  sessionexercise    sessionexercise[]
}

model medical {
  medical_id          Int                 @id
  profession          medical_profession
  specialization_area String?             @db.VarChar(100)
  staff               staff               @relation(fields: [medical_id], references: [staff_id], onDelete: Cascade, map: "fk_medical_staff")
  medicalassessment   medicalassessment[]
}

model medicalassessment {
  athlete_id       Int
  medical_id       Int
  assessment_date  DateTime                            @db.Date
  assessment_type  String?                             @db.VarChar(100)
  notes            String?                             @db.Text
  clearance_status medicalassessment_clearance_status?
  athlete          athlete                             @relation(fields: [athlete_id], references: [athlete_id], onDelete: Cascade, map: "fk_ma_athlete")
  medical          medical                             @relation(fields: [medical_id], references: [medical_id], onDelete: Cascade, map: "fk_ma_medical")

  @@id([athlete_id, medical_id, assessment_date])
  @@index([medical_id], map: "fk_ma_medical")
}

model performancelog {
  athlete_id         Int
  session_id         Int
  exercise_id        Int
  completed_sets     Int?
  completed_reps     Int?
  weight_used        Decimal?        @db.Decimal(6, 2)
  perceived_exertion Int?
  log_time           DateTime?       @default(now()) @db.DateTime(0)
  athlete            athlete         @relation(fields: [athlete_id], references: [athlete_id], onDelete: Cascade, map: "fk_log_athlete")
  sessionexercise    sessionexercise @relation(fields: [session_id, exercise_id], references: [session_id, exercise_id], onDelete: Cascade, map: "fk_log_session_exercise")

  @@id([athlete_id, session_id, exercise_id])
  @@index([session_id, exercise_id], map: "fk_log_session_exercise")
}

model programenrollment {
  athlete_id        Int
  program_id        Int
  enrollment_date   DateTime?                            @default(dbgenerated("(curdate())")) @db.Date
  completion_status programenrollment_completion_status? @default(ongoing)
  athlete           athlete                              @relation(fields: [athlete_id], references: [athlete_id], onDelete: Cascade, map: "fk_enrollment_athlete")
  trainingprogram   trainingprogram                      @relation(fields: [program_id], references: [program_id], onDelete: Cascade, map: "fk_enrollment_program")

  @@id([athlete_id, program_id])
  @@index([program_id], map: "fk_enrollment_program")
}

model sessionexercise {
  session_id     Int
  exercise_id    Int
  planned_sets   Int?
  planned_reps   Int?
  rest_duration  Int?
  performancelog performancelog[]
  exercise       exercise         @relation(fields: [exercise_id], references: [exercise_id], onDelete: Cascade, map: "fk_se_exercise")
  workoutsession workoutsession   @relation(fields: [session_id], references: [session_id], onDelete: Cascade, map: "fk_se_session")

  @@id([session_id, exercise_id])
  @@index([exercise_id], map: "fk_se_exercise")
}

model staff {
  staff_id        Int                   @id
  hire_date       DateTime?             @db.Date
  salary          Decimal?              @db.Decimal(10, 2)
  employment_type staff_employment_type
  medical         medical?
  user            user                  @relation(fields: [staff_id], references: [user_id], onDelete: Cascade, map: "fk_staff_user")
  trainer         trainer?
}

model trainer {
  trainer_id       Int               @id
  specialization   String?           @db.VarChar(100)
  experience_years Int?
  staff            staff             @relation(fields: [trainer_id], references: [staff_id], onDelete: Cascade, map: "fk_trainer_staff")
  trainerfeedback  trainerfeedback[]
  trainingprogram  trainingprogram[]
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model trainerfeedback {
  trainer_id     Int
  athlete_id     Int
  session_id     Int
  rating         Int?
  comments       String?        @db.Text
  athlete        athlete        @relation(fields: [athlete_id], references: [athlete_id], onDelete: Cascade, map: "fk_feedback_athlete")
  workoutsession workoutsession @relation(fields: [session_id], references: [session_id], onDelete: Cascade, map: "fk_feedback_session")
  trainer        trainer        @relation(fields: [trainer_id], references: [trainer_id], onDelete: Cascade, map: "fk_feedback_trainer")

  @@id([trainer_id, athlete_id, session_id])
  @@index([athlete_id], map: "fk_feedback_athlete")
  @@index([session_id], map: "fk_feedback_session")
}

model trainingprogram {
  program_id         Int                               @id @default(autoincrement())
  program_name       String                            @db.VarChar(150)
  difficulty_level   trainingprogram_difficulty_level?
  goal               String?                           @db.Text
  start_date         DateTime?                         @db.Date
  end_date           DateTime?                         @db.Date
  created_by_trainer Int?
  programenrollment  programenrollment[]
  trainer            trainer?                          @relation(fields: [created_by_trainer], references: [trainer_id], map: "fk_program_trainer")
  workoutsession     workoutsession[]

  @@index([created_by_trainer], map: "fk_program_trainer")
}

model user {
  user_id           Int          @id @default(autoincrement())
  first_name        String       @db.VarChar(100)
  last_name         String       @db.VarChar(100)
  email             String       @unique(map: "email") @db.VarChar(255)
  phone             String?      @db.VarChar(20)
  password_hash     String       @db.VarChar(255)
  gender            user_gender?
  date_of_birth     DateTime?    @db.Date
  registration_date DateTime?    @db.DateTime(0)
  status            user_status? @default(active)
  athlete           athlete?
  staff             staff?
}

model workoutsession {
  session_id      Int                             @id @default(autoincrement())
  program_id      Int
  session_date    DateTime                        @db.Date
  duration        Int?
  intensity_level workoutsession_intensity_level?
  sessionexercise sessionexercise[]
  trainerfeedback trainerfeedback[]
  trainingprogram trainingprogram                 @relation(fields: [program_id], references: [program_id], onDelete: Cascade, map: "fk_session_program")

  @@index([program_id], map: "fk_session_program")
}

enum medical_profession {
  doctor
  physiotherapist
  dietitian
}

enum trainingprogram_difficulty_level {
  beginner
  intermediate
  advanced
}

enum programenrollment_completion_status {
  ongoing
  completed
  dropped
}

enum staff_employment_type {
  full_time @map("full-time")
  part_time @map("part-time")
}

enum exercise_difficulty {
  easy
  medium
  hard
}

enum workoutsession_intensity_level {
  low
  medium
  high
}

enum medicalassessment_clearance_status {
  cleared
  restricted
  not_cleared
}

enum user_gender {
  male
  female
  other
}

enum user_status {
  active
  inactive
}
