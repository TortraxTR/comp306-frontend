{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 118, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/defne/comp306-frontend/lib/db.ts"],"sourcesContent":["/*\r\n * MySQL connection pool using mysql2/promise.\r\n * Supports DATABASE_URL or individual DB_* environment variables.\r\n * This module provides a reusable connection pool for raw SQL queries.\r\n */\r\nimport mysql from 'mysql2/promise';\r\n\r\nlet pool: mysql.Pool | null = null;\r\n\r\n/**\r\n * Parse DATABASE_URL format: mysql://user:password@host:port/database\r\n * Returns connection config object.\r\n */\r\nfunction parseDatabaseUrl(url: string) {\r\n  try {\r\n    const urlObj = new URL(url);\r\n    if (urlObj.protocol !== 'mysql:') {\r\n      throw new Error('URL must use mysql: protocol');\r\n    }\r\n    return {\r\n      host: urlObj.hostname,\r\n      port: urlObj.port ? parseInt(urlObj.port, 10) : 3306,\r\n      user: decodeURIComponent(urlObj.username),\r\n      password: decodeURIComponent(urlObj.password),\r\n      database: urlObj.pathname.slice(1), // Remove leading slash\r\n    };\r\n  } catch {\r\n    throw new Error('Invalid DATABASE_URL format. Expected: mysql://user:password@host:port/database');\r\n  }\r\n}\r\n\r\n/**\r\n * Get or create the MySQL connection pool.\r\n * Supports both DATABASE_URL and individual DB_* environment variables.\r\n */\r\nexport function getPool(): mysql.Pool {\r\n  if (pool) {\r\n    return pool;\r\n  }\r\n\r\n  let config: mysql.PoolOptions;\r\n\r\n  if (process.env.DATABASE_URL) {\r\n    // Parse DATABASE_URL\r\n    config = parseDatabaseUrl(process.env.DATABASE_URL);\r\n  } else {\r\n    // Use individual DB_* variables\r\n    config = {\r\n      host: process.env.DB_HOST || 'localhost',\r\n      port: parseInt(process.env.DB_PORT || '3306', 10),\r\n      user: process.env.DB_USER || 'root',\r\n      password: process.env.DB_PASSWORD || '',\r\n      database: process.env.DB_NAME || process.env.DB_DATABASE || 'test',\r\n    };\r\n  }\r\n\r\n  // Add connection pool settings\r\n  pool = mysql.createPool({\r\n    ...config,\r\n    waitForConnections: true,\r\n    connectionLimit: 10,\r\n    queueLimit: 0,\r\n    // Enable multiple statements for future use if needed\r\n    multipleStatements: false,\r\n  });\r\n\r\n  return pool;\r\n}\r\n\r\n/**\r\n * Execute a SELECT query with parameters.\r\n * Returns an array of rows.\r\n */\r\nexport async function query<T = unknown>(\r\n  sql: string,\r\n  params?: unknown[]\r\n): Promise<T[]> {\r\n  const pool = getPool();\r\n  const [rows] = await pool.execute(sql, params);\r\n  return rows as T[];\r\n}\r\n\r\n/**\r\n * Execute an INSERT/UPDATE/DELETE query with parameters.\r\n * Returns the result metadata including insertId and affectedRows.\r\n */\r\nexport async function execute(\r\n  sql: string,\r\n  params?: unknown[]\r\n): Promise<mysql.ResultSetHeader> {\r\n  const pool = getPool();\r\n  const [result] = await pool.execute(sql, params);\r\n  return result as mysql.ResultSetHeader;\r\n}\r\n\r\n/**\r\n * Close the connection pool.\r\n * Useful for cleanup in tests or graceful shutdown.\r\n */\r\nexport async function closePool(): Promise<void> {\r\n  if (pool) {\r\n    await pool.end();\r\n    pool = null;\r\n  }\r\n}\r\n\r\nconst dbExports = { getPool, query, execute, closePool };\r\nexport default dbExports;\r\n"],"names":[],"mappings":";;;;;;;;;;;;AAAA;;;;CAIC,GACD;;AAEA,IAAI,OAA0B;AAE9B;;;CAGC,GACD,SAAS,iBAAiB,GAAW;IACnC,IAAI;QACF,MAAM,SAAS,IAAI,IAAI;QACvB,IAAI,OAAO,QAAQ,KAAK,UAAU;YAChC,MAAM,IAAI,MAAM;QAClB;QACA,OAAO;YACL,MAAM,OAAO,QAAQ;YACrB,MAAM,OAAO,IAAI,GAAG,SAAS,OAAO,IAAI,EAAE,MAAM;YAChD,MAAM,mBAAmB,OAAO,QAAQ;YACxC,UAAU,mBAAmB,OAAO,QAAQ;YAC5C,UAAU,OAAO,QAAQ,CAAC,KAAK,CAAC;QAClC;IACF,EAAE,OAAM;QACN,MAAM,IAAI,MAAM;IAClB;AACF;AAMO,SAAS;IACd,IAAI,MAAM;QACR,OAAO;IACT;IAEA,IAAI;IAEJ,IAAI,QAAQ,GAAG,CAAC,YAAY,EAAE;QAC5B,qBAAqB;QACrB,SAAS,iBAAiB,QAAQ,GAAG,CAAC,YAAY;IACpD,OAAO;QACL,gCAAgC;QAChC,SAAS;YACP,MAAM,QAAQ,GAAG,CAAC,OAAO,IAAI;YAC7B,MAAM,SAAS,QAAQ,GAAG,CAAC,OAAO,IAAI,QAAQ;YAC9C,MAAM,QAAQ,GAAG,CAAC,OAAO,IAAI;YAC7B,UAAU,QAAQ,GAAG,CAAC,WAAW,IAAI;YACrC,UAAU,QAAQ,GAAG,CAAC,OAAO,IAAI,QAAQ,GAAG,CAAC,WAAW,IAAI;QAC9D;IACF;IAEA,+BAA+B;IAC/B,OAAO,8IAAK,CAAC,UAAU,CAAC;QACtB,GAAG,MAAM;QACT,oBAAoB;QACpB,iBAAiB;QACjB,YAAY;QACZ,sDAAsD;QACtD,oBAAoB;IACtB;IAEA,OAAO;AACT;AAMO,eAAe,MACpB,GAAW,EACX,MAAkB;IAElB,MAAM,OAAO;IACb,MAAM,CAAC,KAAK,GAAG,MAAM,KAAK,OAAO,CAAC,KAAK;IACvC,OAAO;AACT;AAMO,eAAe,QACpB,GAAW,EACX,MAAkB;IAElB,MAAM,OAAO;IACb,MAAM,CAAC,OAAO,GAAG,MAAM,KAAK,OAAO,CAAC,KAAK;IACzC,OAAO;AACT;AAMO,eAAe;IACpB,IAAI,MAAM;QACR,MAAM,KAAK,GAAG;QACd,OAAO;IACT;AACF;AAEA,MAAM,YAAY;IAAE;IAAS;IAAO;IAAS;AAAU;uCACxC"}},
    {"offset": {"line": 213, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/defne/comp306-frontend/app/api/trainingprograms/route.ts"],"sourcesContent":["/*\r\nExample Next.js App Router API route for training programs.\r\n- GET: lists trainingprogram rows ordered by program_id and includes enrollments (programenrollment relation).\r\n- POST: accepts JSON body and creates a trainingprogram. Validates presence of program_name.\r\n\r\nNotes:\r\n- This route uses raw SQL queries via mysql2/promise connection pool\r\n- Enrollments are fetched using a JOIN query for efficiency\r\n*/\r\n\r\nimport { NextResponse } from 'next/server';\r\nimport { query, execute } from '../../../lib/db';\r\n\r\n// Types matching the database schema\r\ninterface TrainingProgram {\r\n  program_id: number;\r\n  program_name: string;\r\n  difficulty_level: string | null;\r\n  goal: string | null;\r\n  start_date: Date | null;\r\n  end_date: Date | null;\r\n  created_by_trainer: number | null;\r\n  programenrollment?: ProgramEnrollment[];\r\n}\r\n\r\ninterface ProgramEnrollment {\r\n  athlete_id: number;\r\n  program_id: number;\r\n  enrollment_date: Date | null;\r\n  completion_status: string | null;\r\n}\r\n\r\ninterface ProgramWithEnrollmentRow {\r\n  program_id: number;\r\n  program_name: string;\r\n  difficulty_level: string | null;\r\n  goal: string | null;\r\n  start_date: Date | null;\r\n  end_date: Date | null;\r\n  created_by_trainer: number | null;\r\n  enrollment_athlete_id: number | null;\r\n  enrollment_program_id: number | null;\r\n  enrollment_date: Date | null;\r\n  completion_status: string | null;\r\n}\r\n\r\n// GET /api/trainingprograms\r\nexport async function GET() {\r\n  try {\r\n    // Fetch all training programs with their enrollments using a LEFT JOIN\r\n    const rows = await query<ProgramWithEnrollmentRow>(\r\n      `SELECT \r\n        tp.program_id,\r\n        tp.program_name,\r\n        tp.difficulty_level,\r\n        tp.goal,\r\n        tp.start_date,\r\n        tp.end_date,\r\n        tp.created_by_trainer,\r\n        pe.athlete_id as enrollment_athlete_id,\r\n        pe.program_id as enrollment_program_id,\r\n        pe.enrollment_date,\r\n        pe.completion_status\r\n      FROM trainingprogram tp\r\n      LEFT JOIN programenrollment pe ON tp.program_id = pe.program_id\r\n      ORDER BY tp.program_id ASC`\r\n    );\r\n\r\n    // Group rows by program_id and aggregate enrollments\r\n    const programsMap = new Map<number, TrainingProgram>();\r\n    \r\n    for (const row of rows) {\r\n      if (!programsMap.has(row.program_id)) {\r\n        programsMap.set(row.program_id, {\r\n          program_id: row.program_id,\r\n          program_name: row.program_name,\r\n          difficulty_level: row.difficulty_level,\r\n          goal: row.goal,\r\n          start_date: row.start_date,\r\n          end_date: row.end_date,\r\n          created_by_trainer: row.created_by_trainer,\r\n          programenrollment: [],\r\n        });\r\n      }\r\n      \r\n      const program = programsMap.get(row.program_id)!;\r\n      \r\n      // Add enrollment if it exists (LEFT JOIN may produce null values)\r\n      if (row.enrollment_athlete_id !== null) {\r\n        program.programenrollment!.push({\r\n          athlete_id: row.enrollment_athlete_id,\r\n          program_id: row.enrollment_program_id!,\r\n          enrollment_date: row.enrollment_date,\r\n          completion_status: row.completion_status,\r\n        });\r\n      }\r\n    }\r\n\r\n    const enrichedPrograms = Array.from(programsMap.values());\r\n    return NextResponse.json(enrichedPrograms);\r\n  } catch (error) {\r\n    // Log the error server-side for debugging\r\n    console.error('GET /api/trainingprograms error:', error);\r\n    return NextResponse.json({ error: 'Failed to fetch training programs' }, { status: 500 });\r\n  }\r\n}\r\n\r\n// POST /api/trainingprograms\r\nexport async function POST(req: Request) {\r\n  try {\r\n    const body = await req.json();\r\n\r\n    if (!body || !body.program_name) {\r\n      return NextResponse.json({ error: 'program_name is required' }, { status: 400 });\r\n    }\r\n\r\n    const program_name = String(body.program_name);\r\n    const difficulty_level = body.difficulty_level ?? null;\r\n    const goal = body.goal ?? null;\r\n    // Accept ISO date strings for start/end dates; convert when provided\r\n    const start_date = body.start_date ? new Date(body.start_date) : null;\r\n    const end_date = body.end_date ? new Date(body.end_date) : null;\r\n    const created_by_trainer = body.created_by_trainer ?? null;\r\n\r\n    // Insert the new training program\r\n    const result = await execute(\r\n      `INSERT INTO trainingprogram \r\n       (program_name, difficulty_level, goal, start_date, end_date, created_by_trainer) \r\n       VALUES (?, ?, ?, ?, ?, ?)`,\r\n      [program_name, difficulty_level, goal, start_date, end_date, created_by_trainer]\r\n    );\r\n\r\n    // Fetch the created record to return it (mimicking Prisma's behavior)\r\n    const insertId = result.insertId;\r\n    const created = await query<TrainingProgram>(\r\n      'SELECT * FROM trainingprogram WHERE program_id = ?',\r\n      [insertId]\r\n    );\r\n\r\n    if (created.length === 0) {\r\n      throw new Error('Failed to retrieve created training program');\r\n    }\r\n\r\n    return NextResponse.json(created[0], { status: 201 });\r\n  } catch (error) {\r\n    console.error('POST /api/trainingprograms error:', error);\r\n    return NextResponse.json({ error: 'Failed to create training program' }, { status: 500 });\r\n  }\r\n}\r\n"],"names":[],"mappings":";;;;;;AAAA;;;;;;;;AAQA,GAEA;AACA;;;AAoCO,eAAe;IACpB,IAAI;QACF,uEAAuE;QACvE,MAAM,OAAO,MAAM,IAAA,oHAAK,EACtB,CAAC;;;;;;;;;;;;;;gCAcyB,CAAC;QAG7B,qDAAqD;QACrD,MAAM,cAAc,IAAI;QAExB,KAAK,MAAM,OAAO,KAAM;YACtB,IAAI,CAAC,YAAY,GAAG,CAAC,IAAI,UAAU,GAAG;gBACpC,YAAY,GAAG,CAAC,IAAI,UAAU,EAAE;oBAC9B,YAAY,IAAI,UAAU;oBAC1B,cAAc,IAAI,YAAY;oBAC9B,kBAAkB,IAAI,gBAAgB;oBACtC,MAAM,IAAI,IAAI;oBACd,YAAY,IAAI,UAAU;oBAC1B,UAAU,IAAI,QAAQ;oBACtB,oBAAoB,IAAI,kBAAkB;oBAC1C,mBAAmB,EAAE;gBACvB;YACF;YAEA,MAAM,UAAU,YAAY,GAAG,CAAC,IAAI,UAAU;YAE9C,kEAAkE;YAClE,IAAI,IAAI,qBAAqB,KAAK,MAAM;gBACtC,QAAQ,iBAAiB,CAAE,IAAI,CAAC;oBAC9B,YAAY,IAAI,qBAAqB;oBACrC,YAAY,IAAI,qBAAqB;oBACrC,iBAAiB,IAAI,eAAe;oBACpC,mBAAmB,IAAI,iBAAiB;gBAC1C;YACF;QACF;QAEA,MAAM,mBAAmB,MAAM,IAAI,CAAC,YAAY,MAAM;QACtD,OAAO,gJAAY,CAAC,IAAI,CAAC;IAC3B,EAAE,OAAO,OAAO;QACd,0CAA0C;QAC1C,QAAQ,KAAK,CAAC,oCAAoC;QAClD,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAoC,GAAG;YAAE,QAAQ;QAAI;IACzF;AACF;AAGO,eAAe,KAAK,GAAY;IACrC,IAAI;QACF,MAAM,OAAO,MAAM,IAAI,IAAI;QAE3B,IAAI,CAAC,QAAQ,CAAC,KAAK,YAAY,EAAE;YAC/B,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAA2B,GAAG;gBAAE,QAAQ;YAAI;QAChF;QAEA,MAAM,eAAe,OAAO,KAAK,YAAY;QAC7C,MAAM,mBAAmB,KAAK,gBAAgB,IAAI;QAClD,MAAM,OAAO,KAAK,IAAI,IAAI;QAC1B,qEAAqE;QACrE,MAAM,aAAa,KAAK,UAAU,GAAG,IAAI,KAAK,KAAK,UAAU,IAAI;QACjE,MAAM,WAAW,KAAK,QAAQ,GAAG,IAAI,KAAK,KAAK,QAAQ,IAAI;QAC3D,MAAM,qBAAqB,KAAK,kBAAkB,IAAI;QAEtD,kCAAkC;QAClC,MAAM,SAAS,MAAM,IAAA,sHAAO,EAC1B,CAAC;;gCAEyB,CAAC,EAC3B;YAAC;YAAc;YAAkB;YAAM;YAAY;YAAU;SAAmB;QAGlF,sEAAsE;QACtE,MAAM,WAAW,OAAO,QAAQ;QAChC,MAAM,UAAU,MAAM,IAAA,oHAAK,EACzB,sDACA;YAAC;SAAS;QAGZ,IAAI,QAAQ,MAAM,KAAK,GAAG;YACxB,MAAM,IAAI,MAAM;QAClB;QAEA,OAAO,gJAAY,CAAC,IAAI,CAAC,OAAO,CAAC,EAAE,EAAE;YAAE,QAAQ;QAAI;IACrD,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,qCAAqC;QACnD,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAoC,GAAG;YAAE,QAAQ;QAAI;IACzF;AACF"}}]
}